<workflow>
  <critical>The workflow execution engine is governed by: {project-root}/_bmad/core/tasks/workflow.xml</critical>
  <critical>You MUST have already loaded and processed: {installed_path}/workflow.yaml</critical>
  <critical>Communicate all responses in {communication_language} and generate all documents in {document_output_language}</critical>

  <critical>
    REAL Beads integration (steveyegge/beads):
    - Canonical tracker is Beads issues (bd).
    - This workflow does NOT create a story .md file.
    - It enriches a Beads story issue by adding a full BMAD story spec as a comment.

    Required tools:
    - bd init
    - bd list / bd ready
    - bd show
    - bd comments add
    - bd label add
  </critical>

  <step n="1" goal="Select a story issue to enrich">
    <action>Ensure `bd` is installed and available.</action>
    <action>Run `bd init` if needed.</action>
    <action>Find candidate story issues:
      - Prefer: bd list --status open --label bmad-story --json
      - Or: bd ready --json (filter for label bmad-story)
    </action>
    <action>Select the next story issue to enrich and set {{issue_id}}.</action>
    <action>Load the issue: bd show {{issue_id}} --json</action>
    <action>Load relevant project docs (epics/prd/architecture + {project_context} if exists) for context.</action>
  </step>

  <step n="2" goal="Generate BMAD story spec and attach to issue">
    <action>Generate a complete story spec markdown including:
      - Story summary
      - Acceptance Criteria
      - Tasks/Subtasks (ordered)
      - Dev Notes / constraints
      - Test requirements
      - Status conventions for bd (open/in_progress/blocked/closed)
    </action>

    <action>Attach the spec as a comment (canonical, append-only):
      - bd comments add {{issue_id}} "<BMAD STORY SPEC MARKDOWN>"
    </action>

    <action>Add labels to indicate readiness:
      - bd label add {{issue_id}} ready-for-dev
    </action>

    <output>âœ… Story spec attached to Beads issue {{issue_id}} (ready-for-dev label added)</output>
  </step>
</workflow>
